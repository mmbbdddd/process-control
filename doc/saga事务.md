# saga事务介绍

## 原理
![img_22.png](img_22.png)

* 一个长流程复杂事务由N个节点装成
* 其中每两个执行节点的状态变迁组成了一个原子变迁
* 确保每个原子变迁的一致性，如此反复执行，就能确保整个流程的一致性
* 每个原子变迁的事务机制如图
  * 1，在业务执行前，先将状态改为当前状态的容错状态，如果失败则停止。
  * 2，成功则执行业务逻辑，并更改状态为目标状态
  * 3，2步骤中有异常，则状态位为容错状态，下次执行时查询当前节点目标状态。


saga事务的本质

    1，微积分事务，base一致性
    2，将一个非冥等业务逻辑，转为一个冥等业务逻辑（执行条件查询+执行）


## 概念介绍

* 流程：包含了N个执行步骤
* 原子变迁类型
  * saga：变迁是非冥等的，从from状态到failover状态/目标中泰，中间执行的是业务逻辑，变迁是非冥等的。失败则状态在failover。
  * router：从failover到目标状态集合，中间执行的是业务执行状态查询逻辑（结果有多个），变迁是冥等的，
  * to：从from到to，中间执行的是业务查询逻辑，（如信息查询，结果只有一个）变迁是冥等的，失败则返回from再次执行。


# 事务实现机制比较

![img_23.png](img_23.png)


